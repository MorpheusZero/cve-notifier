package cmds

import (
	"fmt"
	"github.com/MorpheusZero/cve-notifier/common/lib"
	"os"
)

func Run() {
	url := "https://github.com/CVEProject/cvelistV5/releases/download/cve_2024-03-15_2300Z/2024-03-15_delta_CVEs_at_2300Z.zip" // URL of the zip file
	zipFilePath := "archive.zip"                                                                                               // Path to save the downloaded zip file

	err := lib.DownloadFileFromURLAndSaveToPath(url, zipFilePath)
	if err != nil {
		fmt.Println("[CVE Notifier] Error downloading file: ", err)
		return
	}
	defer func(name string) {
		err := os.Remove(name)
		if err != nil {
			fmt.Println("[CVE Notifier] Error removing archive file: ", err)
		}
	}(zipFilePath) // Remove the zip file after unzipping

	err = lib.UnzipFileToNewPath(zipFilePath, "output_folder") // Output folder where the contents will be extracted
	if err != nil {
		fmt.Println("[CVE Notifier] Error unzipping file: ", err)
		return
	}

	fmt.Println("[CVE Notifier] File downloaded and unzipped successfully!")
}
